{% extends 'base-manager.html.twig' %}
{% block page_specific_scripts %}
    {% include 'includes/scripts-tables.html.twig' %}
    {% include 'includes/scripts-charts.js.html.twig' %}
    <script>
        Charts.create('#investors-ownership-chart', 'doughnut', {
                cutoutPercentage: 70,
                tooltips: {
                    callbacks: {
                        title: function (e, t) {
                            return t.labels[e[0].index]
                        }, label: function (e, t) {
                            return "" + '<span class="popover-body-value">' + t.datasets[0].data[e.index] + "%</span>"
                        }
                    }
                }
            }, {
                labels: '{{ charts.doughnut.labels }}'.split(', '),
                datasets: [{
                    data: '{{ charts.doughnut.rates }}'.split(', '),
                    backgroundColor: '{{ charts.doughnut.colors }}'.split(', '),
                    borderColor: settings.colors.white,
                    hoverBorderColor: settings.colors.white
                }]
            }
        );
        Charts.create('#daily-grind-chart', 'line', {
            tooltips: {
                callbacks: {
                    title: function (e, t) {
                        return t.labels[e[0].index]
                    }, label: function (e, t) {
                        console.log('e', e)
                        console.log('t', t)
                        return '<span class="popover-body-value">' + t.datasets[0].data[e.index] + " SLP</span>"
                    }
                }
            }
        }, {
            labels: '{{ charts.line.labels }}'.split(', '),
            datasets: [
                {
                    data: '{{ charts.line.data }}'.split(', '),
                }
            ]
        });
    </script>
{% endblock %}
{% block breadcrumb %}
    {% include 'includes/breadcrumb.html.twig' with {
        'trails': {
            0: {
                'url': site_url('manager/teams'),
                'name': 'My Teams'
            },
            'active': {
                'url': null,
                'name': 'Details'
            }
        }
    } %}
{% endblock breadcrumb %}
{% set labels = charts.doughnut.labels|split(', ') %}
{% set colors = charts.doughnut.colors|split(', ') %}
{% set rates = charts.doughnut.rates|split(', ') %}
{% block content %}
    <nav class="navbar navbar-light border-bottom border-top pl-0">
        <ul class="nav navbar-nav">
            <li class="nav-item">
                <a href="{{ site_url('manager/teams') }}" class="nav-link text-70"><i class="material-icons icon--left">keyboard_backspace</i>
                    Back to Teams</a>
            </li>
        </ul>
    </nav>
    <div class="page-section">
        {% if team %}
            <h4>{{ team.AssetTeamName }}</h4>
            <div class="row card-group-row">
                <div class="col-md-6 col-sm-12 col-lg-5 card-group-row__col">
                    <div class="card card-group-row__card">
                        <div class="card-header p-0">
                            <div class="row no-gutters flex" role="tablist">
                                <div class="col-auto">
                                    <div class="p-card-header d-flex align-items-center">
                                        <div class="h2 mb-0 mr-3">
                                            <img class="avatar-img rounded-circle avatar-sm"
                                                 src="{{ load_static('assets/chndrwr/images/axies/axie_avatar_15.png') }}"
                                                 alt="Axie" width="45">
                                        </div>
                                        <div class="flex">
                                            <p class="mb-0">
                                                <strong>#{{ toMoneyFormat(team.AxieTeam.AxieTeamRank, false) }}</strong></p>
                                            <p class="text-50 mb-0 d-flex align-items-center">
                                                <small>Team Rank</small>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto border-left" data-toggle="tooltip" title="Match Making Rating">
                                    <div class="p-card-header d-flex align-items-center">
                                        <div class="flex mt-1">
                                            <p class="mb-0">
                                                <strong>{{ toMoneyFormat(team.AxieTeam.AxieTeamMMR, false) }}</strong></p>
                                            <p class="text-50 mb-0 d-flex align-items-center">
                                                <small><em>MMR</em></small>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-auto border-left">
                                    <div class="p-card-header d-flex align-items-center">
                                        <div class="flex mt-1">
                                            <p class="mb-0 d-flex align-items-center">
                                                {% if team.AssetTeamStatus %}
                                                    <i class="fa fa-circle" style="font-size: 8px; color: greenyellow"></i>
                                                    <strong>&nbsp;Active</strong>
                                                {% else %}
                                                    <i class="fa fa-circle text-warning" style="font-size: 8px;"></i>
                                                    <strong>&nbsp;Pending</strong>
                                                {% endif %}
                                            </p>
                                            <p class="text-50 mb-0 d-flex align-items-center">
                                                <small>Status</small>
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body d-flex flex-column">
                            <small class="text-muted text-uppercase mb-3 d-block font-weight-bold">Team Details</small>
                            <small class="d-flex align-items-center font-weight-bold text-muted mb-2">
                                <span class="flex text-body">Team Value</span>
                                <span class="d-flex align-items-center">{{ peso_symbol ~ ' ' ~ toMoneyFormat(team.AssetTeamValue) }}</span>
                            </small>
                            {#                        <small class="d-flex align-items-center font-weight-bold text-muted mb-2">#}
                            {#                            <span class="flex text-body">Collected Amount</span>#}
                            {#                            <span class="d-flex align-items-center">{{ peso_symbol ~ ' ' ~ toMoneyFormat(team.AssetTeamCollectedAmount) }}</span>#}
                            {#                        </small>#}
                            <small class="d-flex align-items-center font-weight-bold text-muted mb-2">
                            <span class="flex text-body">
                                <span class="text-body">
                                    Current <em data-toggle="tooltip" title="Axie Infinity Shards">AXS</em>
                                    Balance
                                </span>
                            </span>
                                <span class="d-flex align-items-center">{{ toMoneyFormat(team.AxieTeam.AxieTeamCurrentAXSBalance) }}</span>
                            </small>
                            <small class="d-flex align-items-start font-weight-bold text-muted mb-2">
                            <span class="flex d-flex flex-column">
                                <span class="text-body">Current <em data-toggle="tooltip"
                                                                    title="Small Love Potion">SLP</em> Balance</span>
                                Updated everyday
                            </span>
                                <span class="d-flex align-items-center ml-1">
                                 {{ toMoneyFormat(team.AxieTeam.AxieTeamCurrentSLPBalance, false) }} SLP
                            </span>
                            </small>
                            <small class="d-flex align-items-center font-weight-bold text-muted">
                                <span class="flex text-body">Axies</span>
                            </small>
                            <a href="{{ team.AxieTeam.AxieTeamAvatar1URL }}"
                               class="d-flex align-items-center font-weight-bold text-muted ml-2" target="_blank">
                                <span class="flex">1. {{ team.AxieTeam.AxieTeamAvatar1Type }}</span>
                                <span class="d-flex align-items-center">
                                    <i class="material-icons text-20 icon-16pt">link</i>
                            </span>
                            </a>
                            <a href="{{ team.AxieTeam.AxieTeamAvatar2URL }}"
                               class="d-flex align-items-center font-weight-bold text-muted ml-2" target="_blank">
                                <span class="flex">2. {{ team.AxieTeam.AxieTeamAvatar2Type }}</span>
                                <span class="d-flex align-items-center">
                                    <i class="material-icons text-20 icon-16pt">link</i>
                            </span>
                            </a>
                            <a href="{{ team.AxieTeam.AxieTeamAvatar3URL }}"
                               class="d-flex align-items-center font-weight-bold text-muted ml-2 mb-2" target="_blank">
                                <span class="flex">3. {{ team.AxieTeam.AxieTeamAvatar3Type }}</span>
                                <span class="d-flex align-items-center">
                                    <i class="material-icons text-20 icon-16pt">link</i>
                            </span>
                            </a>
                            <small class="d-flex align-items-center font-weight-bold text-muted">
                                <span class="flex text-body">Axie Scholar</span>
                            </small>
                            <small class="d-flex align-items-center font-weight-bold text-muted ml-2">
                                <span class="flex">ChainDrawer Scholar #{{ team.AxieTeam.getAxieScholar.PlayerID }}</span>
                            </small>
                            {#                        <small class="d-flex align-items-center font-weight-bold text-muted mb-1">#}
                            {#                            <span class="flex text-body">Scholar/Axie Player</span>#}
                            {#                        </small>#}
                            {#                        <div class="d-flex align-items-center" style="white-space: nowrap;">#}
                            {#                            <div class="avatar avatar-32pt mr-8pt">#}
                            {#                                <span class="avatar-title rounded-circle">#{{ team.AxieTeam.getAxieScholar.PlayerID }}</span>#}
                            {#                            </div>#}
                            {#                            <div class="flex ml-4pt">#}
                            {#                                <div class="d-flex flex-column">#}
                            {#                                    <p class="mb-0"><strong>{{ team.AxieTeam.getAxieScholar.PlayerIGN }}</strong></p>#}
                            {#                                    #}{# <small class="text-50"><a href="#">See Profile</a></small> #}
                            {#                                </div>#}
                            {#                            </div>#}
                            {#                            #}{# <a href="javascript:void(0);"><i class="material-icons text-20 icon-16pt">email</i></a> #}
                            {#                        </div>#}
                        </div>
                        <div class="card-footer">
                            <strong>Daily SLP Grind</strong>
                            {% if charts.line.has_data %}
                                <div class="chart"
                                     style="height: 100px;">
                                    <canvas class="chart-canvas js-update-chart-line js-update-chart-area"
                                            id="daily-grind-chart"
                                            data-chart-hide-axes="true"
                                            data-chart-line-background-color="gradient:yellow"
                                            data-chart-line-background-opacity="0.24"
                                            data-chart-line-border-color="yellow">
                                    </canvas>
                                </div>
                            {% else %}
                                <div class="d-flex align-items-center mt-2">
                                    <strong>No data yet.</strong>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-sm-12 col-lg-7 card-group-row__col">
                    <div class="card card-group-row__card" style="position: relative; /*padding-bottom: calc(80px - 1.25rem);overflow: hidden; */ z-index: 0;">
                        <div class="card-body">
                            <div class="d-flex">
                                <div class="flex mr-3">
                                    <div class="h2 mb-0">Managers</div>
                                    <div class="d-flex flex-column">
                                        <p class="mb-0"><strong>Earnings Rate Allocation</strong></p>
                                        <small class="text-50">{{ team.TeamManagerCount }} {{ team.TeamManagerCount == 0 or team.TeamManagerCount > 1 ? 'Managers' : 'Manager' }}</small>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-24pt">
                                <div class="col-lg-5 d-flex align-items-center justify-content-center">
                                    <div class="chart" style="height: 190px;">
                                        <div class="text-center fullbleed d-flex align-items-center justify-content-center flex-column z-0">
                                            <h2 class="m-0">{{ team.TeamProfitShare|round }}%</h2>
                                            <strong>Team Profit<br>Share</strong>
                                        </div>
                                        <canvas class="chart-canvas position-relative z-1"
                                                id="investors-ownership-chart">
                                        </canvas>
                                    </div>
                                </div>
                                <div class="col-lg-7">
                                    <div class="d-flex flex-column justify-content-center mb-12pt mb-lg-0 mt-24pt mt-lg-0">
                                        <small class="text-muted text-uppercase mb-2 d-block font-weight-bold">manager
                                            id</small>
                                        {% for i in 0..team.TeamManagerCount - 1 %}
                                            <small class="d-flex align-items-center font-weight-bold text-muted mb-1 {% if labels[i]  == 'Me' %}bg-dark{% endif %}">
                                        <span class="flex text-body ml-2">
                                            <i class="fa fa-chart-pie" style="color: {{ colors[i] }}"></i>
                                            {{ labels[i] }}
                                        </span>
                                                <span class="mx-2">{{ rates[i] }}%</span>
                                            </small>
                                        {% endfor %}
                                    </div>

                                    {#                                <strong>Income Breakdown</strong>#}
                                    {#                                <div class="table-responsive">#}
                                    {#                                    <table class="mt-2 table table-sm mb-0 thead-border-top-0 table-nowrap">#}
                                    {#                                        <thead>#}
                                    {#                                        <tr>#}
                                    {#                                            <th>Investor ID</th>#}
                                    {#                                            <th>Ownership</th>#}
                                    {#                                            <th>SLP</th>#}
                                    {#                                            <th>PHP</th>#}
                                    {#                                        </tr>#}
                                    {#                                        </thead>#}
                                    {#                                        <tbody class="list" id="clients">#}
                                    {#                                        {% if charts.doughnut.has_data %}#}
                                    {#                                            {% for manager in team.getTeamManagers %}#}
                                    {#                                                {% if user.getUserID == manager.UserID %}#}
                                    {#                                                    {% set selected = 'selected font-weight-bolder' %}#}
                                    {#                                                    {% set m = 'Me' %}#}
                                    {#                                                {% else %}#}
                                    {#                                                    {% set selected = '' %}#}
                                    {#                                                    {% set m = labels[loop.index - 1] %}#}
                                    {#                                                {% endif %}#}
                                    {#                                                <tr class="{{ selected }}">#}
                                    {#                                                    <td>#}
                                    {#                                                        {{ m }}#}
                                    {#                                                    </td>#}
                                    {#                                                    <td>{{ manager.OwnershipRate }}%</td>#}
                                    {#                                                    <td>{{ toMoneyFormat((team.AxieTeam.AxieTeamCurrentSLPBalance * (manager.OwnershipRate / 100))|round, false) }}</td>#}
                                    {#                                                    <td>{{ peso_symbol ~ ' ' ~ toMoneyFormat((12782.64 * (manager.OwnershipRate / 100)|round)) }}</td>#}
                                    {#                                                </tr>#}
                                    {#                                            {% endfor %}#}
                                    {#                                        {% else %}#}
                                    {#                                            <tr>#}
                                    {#                                                <td><strong>No data yet.</strong></td>#}
                                    {#                                            </tr>#}
                                    {#                                        {% endif %}#}
                                    {#                                        </tbody>#}
                                    {#                                    </table>#}
                                    {#                                </div>#}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6 col-sm-12 col-lg-5"></div>
                <div class="col-md-6 col-sm-12 col-lg-7">
                </div>
            </div>
        {% else %}
            <h4>No data</h4>
        {% endif %}
    </div>
{% endblock content %}

