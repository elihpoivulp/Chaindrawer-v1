{% extends 'base-manager.html.twig' %}
{% block breadcrumb %}
   {% include 'includes/breadcrumb.html.twig' with {
       'section': 'Account',
       'trails': {
           'active': {
               'url': null,
               'name': 'Dashboard'
           }
       }
   } %}
{% endblock breadcrumb %}
{% block content %}
    <div class="page-section">
        <div class="page-separator">
            <div class="page-separator__text">Account Overview</div>
        </div>
        <div class="row card-group-row mb-lg-8pt">
            <div class="col-lg-5 card-group-row__col">
                <div class="card card-group-row__card">
                    <div class="card-header d-flex">
                        <div class="flex row">
                            <div class="col-auto d-flex flex-column">
                                <div class="h2 mb-0">{{ peso_symbol ~ ' ' ~ account.manager.getShortFormattedAsset }}</div>
                                <p class="mb-0"><strong>Total Assets</strong></p>
                            </div>
                            <div class="col-auto border-left d-flex flex-column">
                                <div class="h2 mb-0">{{ peso_symbol ~ ' ' ~ account.manager.getTotalIncome }}</div>
                                <p class="mb-0"><strong>Total Income</strong></p>
                            </div>
                        </div>
                        <a href="#"><i class="material-icons text-50">more_horiz</i></a>
                    </div>
                    <div class="card-body d-flex flex-column justify-content-start">
                        {% for team in account.manager.getTeamsAndPayouts %}
                            {% if team.TotalReturned < team.ManagerShareAmount %}
                                {% set return_rate = (team.TotalReturned / team.ManagerShareAmount) * 100 %}
                            {% else %}
                                {% set return_rate = 100 %}
                            {% endif %}
                            <div class="mb-8pt">
                                <p class="d-flex align-items-center mb-4pt">
                                    <small class="flex lh-24pt"><strong>{{ team.AssetTeamName }}</strong></small>
                                    <small class="text-50 lh-24pt">{{ peso_symbol }} {{ toShortFormat(team.ManagerShareAmount) }}</small>
                                </p>
                                <div class="progress" style="height: 12px;" data-toggle="tooltip" data-placement="top"
                                     title="{{ round(return_rate) }}%">
                                    <div class="progress-bar bg-accent text-black-100" role="progressbar"
                                         style="width: {{ round(return_rate) }}%;"
                                         aria-valuenow="{{ round(return_rate) }}" aria-valuemin="0" aria-valuemax="100">{{ round(return_rate) }}%
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="col-lg-7 card-group-row__col">
                <div class="card card-group-row__card">
                    <div class="card-header d-flex align-items-center">
                        <strong>Monthly Income Chart</strong>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <canvas id="monthy_income"
                                    class="chart-canvas js-update-chart-bar"
                                    data-chart-prefix="{{ peso_symbol }} "
                                    data-chart-line-background-color="gradient:primary"
                                    data-chart-dark-mode="1">
                            </canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="page-separator">
        <div class="page-separator__text">Updates</div>
    </div>
    <div class="row card-group-row mb-lg-8pt">
        <div class="col-lg-7 card-group-row__col">
            <div class="card card-group-row__card d-flex flex-column">
                <div class="card-header">
                    <strong>SLP Watch</strong>
                </div>
                <div class="card-body d-flex flex-row align-items-center flex-0">
                    <div class="h2 mb-0 mr-3">{{ peso_symbol ~ data.current_rate }}</div>
                    <div class="flex">
                        <p class="mb-0"><strong>{{ data.today }}</strong></p>
                        <div class="text-50 mt-n1 d-flex align-items-center">PHP rate per SLP in the last 3 days
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="chart w-100">
                        <canvas class="chart-canvas js-update-chart-line js-update-chart-area"
                                id="slp_histo"
                                data-chart-line-background-color="primary"
                                data-chart-line-background-opacity="0.24"
                                data-chart-line-border-color="teal"
                                data-chart-prefix="{{ peso_symbol }} "
                                data-chart-dark-mode="1">
                        </canvas>
                    </div>
                </div>
                 <div class="card-footer">
                 <small class="text-muted">
                 Data from
                 <a href="https://www.coingecko.com/en/api/documentation" target="_blank"> CoinGecko API</a>
                 </small>
                 </div>
            </div>
        </div>
        <div class="col-lg-5 card-group-row__col">
            <div class="card card-group-row__card">
                <div class="card-header">
                    <strong>Latest Announcements <span class="badge badge-notifications badge-accent">1</span></strong>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <div class="list-group-item d-flex align-items-start p-16pt">
                            <div class="d-flex flex-column mr-16pt">
                                <small class="text-uppercase text-50">{{ data.today|date('M') }}</small>
                                <strong class="border-bottom-2 border-bottom-accent">{{ data.today|date('d') }}</strong>
                            </div>
                            <div class="flex">
                                <div class="mb-8pt">
                                    <strong>
                                        Welcome!
                                        <span class="badge badge-pill badge-accent"
                                              style="font-size: 4px; position: absolute; margin-left: 2px;">&nbsp;</span>
                                    </strong>
                                </div>
                                <div class="mb-0 text-50">
                                    <p>Welcome Paps...</p>
                                </div>
                                <a href="" class="text-70 text-underline">read more</a>
                            </div>
                        </div>
                        <div class="list-group-item d-flex align-items-start p-16pt">
                            <div class="d-flex flex-column mr-16pt">
                                <small class="text-uppercase text-50">{{ data.today|date('M') }}</small>
                                <strong class="border-bottom-2 border-bottom-accent">{{ data.today|date('d') }}</strong>
                            </div>
                            <div class="flex">
                                <div class="mb-8pt text-muted"><strong>Service's Privacy Policy and Terms of
                                        Use</strong></div>

                                <a href="" class="d-flex align-items-center border-1 rounded mb-0 p-8pt">
                                                    <span class="mr-8pt p-8pt bg-secondary rounded"
                                                          style="width: 40px; height: 40px;">
                                                        <i class="material-icons icon-24pt text-white">file_download</i>
                                                    </span>
                                    <span class="flex d-flex flex-column">
                                                        <span class="text-100">chaindrawer.pdf</span>
                                                        <span class="text-50 lh-1">1.3 Mb</span>
                                                    </span>
                                    <span class="text-70 text-underline mr-8pt">download</span>
                                </a>

                            </div>
                        </div>

                    </div>
                </div>
                <div class="card-footer">
                    <p><a href="#">Show all</a></p>
                </div>
            </div>
        </div>
    </div>
    {% block page_specific_scripts %}
        {% include 'includes/scripts-charts.js.html.twig' %}
        <script>
            Charts.create('#slp_histo', 'area', {
                scales: {
                    responsive: true,
                    xAxes: [{
                        ticks: {
                            padding: 4, callback: function (t) {
                                return t
                            },
                            beginAtZero: true,
                        },
                        display: true,
                        gridLines: {display: !1},
                        type: "time",
                        time: {
                            unit: "day",
                            displayFormats: {day: "MM/DD"},
                            maxTicksLimit: 7,
                            autoSkip: !1
                        }
                    }]
                }
            }, {
                datasets: [
                    {{ data.api|raw }}
                ],
                borderWidth: 4,
            });
            Charts.create('#monthy_income', 'roundedBar', {
                tooltips: {
                    callbacks: {
                        label: function(tooltipItem, data) {
                            // console.log(data);
                            return '{{ peso_symbol }} ' + tooltipItem.yLabel.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
                        }
                    }
                }
            }, {
                labels: '{{ monthly_payouts.labels }}'.split(', '),
                datasets: [{{ monthly_payouts.payouts|raw }}],
                borderWidth: 4,
            });

        </script>
    {% endblock page_specific_scripts %}

{% endblock content %}